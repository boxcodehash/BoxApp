<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>MuzzSnap - Cyberpunk Edition</title>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap');
    
    * { 
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    body { 
      font-family: 'Rajdhani', sans-serif;
      background: #000;
      color: #fff;
      overflow: hidden;
    }

    .cyber-bg {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at 50% 50%, rgba(139, 0, 0, 0.3) 0%, #000 100%);
      z-index: -1;
    }

    .cyber-bg::before {
      content: '';
      position: absolute;
      inset: 0;
      background-image: 
        repeating-linear-gradient(0deg, rgba(255, 0, 0, 0.03) 0px, transparent 1px, transparent 2px, rgba(255, 0, 0, 0.03) 3px),
        repeating-linear-gradient(90deg, rgba(255, 0, 0, 0.03) 0px, transparent 1px, transparent 2px, rgba(255, 0, 0, 0.03) 3px);
      animation: scan 8s linear infinite;
    }

    @keyframes scan {
      0% { transform: translateY(0); }
      100% { transform: translateY(20px); }
    }

    .container-main {
      display: flex;
      height: 100vh;
      padding: 20px;
      gap: 20px;
    }

    @media (max-width: 768px) {
      .container-main { padding: 10px; gap: 10px; }
    }

    /* SIDEBAR */
    .sidebar {
      width: 340px;
      background: rgba(20, 0, 0, 0.8);
      border: 2px solid rgba(255, 0, 0, 0.3);
      border-radius: 20px;
      padding: 30px 20px;
      backdrop-filter: blur(20px);
      box-shadow: 0 0 40px rgba(255, 0, 0, 0.2), inset 0 0 60px rgba(255, 0, 0, 0.05);
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
    }

    .sidebar::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, #ff0000, transparent);
      animation: glow-line 2s ease-in-out infinite;
    }

    @keyframes glow-line {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }

    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        left: 10px;
        top: 10px;
        bottom: 10px;
        z-index: 100;
        transform: translateX(-110%);
        transition: transform 0.3s ease;
      }
      .sidebar.open { transform: translateX(0); }
    }

    .logo {
      font-family: 'Orbitron', sans-serif;
      font-size: 32px;
      font-weight: 900;
      text-align: center;
      background: linear-gradient(135deg, #ff0000 0%, #cc0000 50%, #990000 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: 4px;
      margin-bottom: 30px;
      text-shadow: 0 0 30px rgba(255, 0, 0, 0.5);
    }

    .section-title {
      font-size: 11px;
      font-weight: 700;
      color: rgba(255, 255, 255, 0.4);
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 15px;
      margin-top: 20px;
    }

    .channel-btn {
      width: 100%;
      padding: 14px 20px;
      background: rgba(139, 0, 0, 0.2);
      border: 1px solid rgba(255, 0, 0, 0.2);
      border-radius: 12px;
      color: rgba(255, 255, 255, 0.6);
      font-size: 16px;
      font-weight: 600;
      text-align: left;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 10px;
      position: relative;
      overflow: hidden;
    }

    .channel-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 0, 0, 0.2), transparent);
      transition: left 0.5s ease;
    }

    .channel-btn:hover::before {
      left: 100%;
    }

    .channel-btn:hover {
      border-color: rgba(255, 0, 0, 0.5);
      color: #fff;
      transform: translateX(5px);
    }

    .channel-btn.active {
      background: linear-gradient(135deg, rgba(255, 0, 0, 0.4), rgba(139, 0, 0, 0.6));
      border-color: #ff0000;
      color: #fff;
      box-shadow: 0 0 20px rgba(255, 0, 0, 0.3);
    }

    .channel-btn.active::after {
      content: '‚úì';
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #ff0000;
      font-size: 20px;
    }

    .user-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 15px;
      border-radius: 10px;
      margin-bottom: 8px;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .user-item:hover {
      background: rgba(139, 0, 0, 0.2);
      border-color: rgba(255, 0, 0, 0.3);
      transform: translateX(5px);
    }

    .user-status {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #00ff00;
      box-shadow: 0 0 10px #00ff00;
      animation: pulse 2s ease-in-out infinite;
    }

    .user-status.admin {
      background: #ffcc00;
      box-shadow: 0 0 15px #ffcc00;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .user-name {
      font-size: 14px;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.9);
    }

    .user-name.admin {
      color: #ffcc00;
      text-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
    }

    .admin-btn {
      width: 100%;
      padding: 14px;
      background: rgba(255, 204, 0, 0.1);
      border: 2px solid rgba(255, 204, 0, 0.4);
      border-radius: 12px;
      color: #ffcc00;
      font-size: 12px;
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: 2px;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 20px;
    }

    .admin-btn:hover {
      background: rgba(255, 204, 0, 0.2);
      border-color: #ffcc00;
      box-shadow: 0 0 20px rgba(255, 204, 0, 0.3);
      transform: scale(1.02);
    }

    .disconnect-btn {
      width: 100%;
      padding: 10px;
      background: transparent;
      border: none;
      color: rgba(255, 255, 255, 0.3);
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 10px;
    }

    .disconnect-btn:hover {
      color: #ff0000;
    }

    /* CHAT AREA */
    .chat-container {
      flex: 1;
      background: rgba(20, 0, 0, 0.8);
      border: 2px solid rgba(255, 0, 0, 0.3);
      border-radius: 20px;
      backdrop-filter: blur(20px);
      box-shadow: 0 0 40px rgba(255, 0, 0, 0.2), inset 0 0 60px rgba(255, 0, 0, 0.05);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
    }

    .alert-banner {
      background: linear-gradient(90deg, #ff0000, #cc0000, #ff0000);
      background-size: 200% 100%;
      animation: banner-slide 3s linear infinite;
      padding: 15px;
      text-align: center;
      font-weight: 900;
      font-size: 13px;
      letter-spacing: 2px;
      text-transform: uppercase;
      box-shadow: 0 4px 20px rgba(255, 0, 0, 0.5);
      position: relative;
      overflow: hidden;
    }

    .alert-banner::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      animation: shine 2s infinite;
    }

    @keyframes banner-slide {
      0% { background-position: 0% 50%; }
      100% { background-position: 200% 50%; }
    }

    @keyframes shine {
      0% { left: -100%; }
      100% { left: 200%; }
    }

    .chat-header {
      padding: 20px 30px;
      border-bottom: 1px solid rgba(255, 0, 0, 0.2);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(0, 0, 0, 0.3);
    }

    .menu-btn {
      display: none;
      width: 40px;
      height: 40px;
      background: rgba(255, 0, 0, 0.2);
      border: 1px solid rgba(255, 0, 0, 0.3);
      border-radius: 10px;
      color: #ff0000;
      font-size: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .menu-btn:hover {
      background: rgba(255, 0, 0, 0.3);
      box-shadow: 0 0 15px rgba(255, 0, 0, 0.3);
    }

    @media (max-width: 768px) {
      .menu-btn { display: flex; align-items: center; justify-content: center; }
    }

    .sector-label {
      font-size: 14px;
      font-weight: 700;
      color: rgba(255, 255, 255, 0.6);
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .sector-name {
      color: #ff0000;
      font-weight: 900;
      text-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
    }

    .theme-toggle-container {
      width: 50px;
      height: 26px;
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255, 0, 0, 0.3);
      border-radius: 20px;
      position: relative;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .theme-toggle-container:hover {
      border-color: #ff0000;
      box-shadow: 0 0 15px rgba(255, 0, 0, 0.3);
    }

    .theme-toggle-circle {
      width: 20px;
      height: 20px;
      background: linear-gradient(135deg, #ff0000, #cc0000);
      border-radius: 50%;
      position: absolute;
      top: 2px;
      left: 3px;
      transition: all 0.3s ease;
      box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
    }

    .theme-toggle-container.light .theme-toggle-circle {
      left: 27px;
    }

    .messages-area {
      flex: 1;
      overflow-y: auto;
      padding: 30px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .messages-area::-webkit-scrollbar {
      width: 8px;
    }

    .messages-area::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.3);
    }

    .messages-area::-webkit-scrollbar-thumb {
      background: rgba(255, 0, 0, 0.3);
      border-radius: 10px;
    }

    .messages-area::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 0, 0, 0.5);
    }

    .message-wrapper {
      display: flex;
      flex-direction: column;
      margin-bottom: 8px;
    }

    .message-wrapper.me {
      align-items: flex-end;
    }

    .message-author {
      font-size: 11px;
      font-weight: 700;
      color: rgba(255, 255, 255, 0.5);
      margin-bottom: 6px;
      padding: 0 12px;
      letter-spacing: 1px;
    }

    .message-author.admin {
      color: #ffcc00;
      text-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
    }

    .message-bubble {
      max-width: 70%;
      padding: 14px 18px;
      border-radius: 18px;
      font-size: 15px;
      font-weight: 500;
      line-height: 1.5;
      word-wrap: break-word;
      position: relative;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .message-bubble.me {
      background: linear-gradient(135deg, rgba(255, 0, 0, 0.8), rgba(139, 0, 0, 0.8));
      color: #fff;
      border: 1px solid rgba(255, 0, 0, 0.5);
      box-shadow: 0 4px 15px rgba(255, 0, 0, 0.3);
    }

    .message-bubble.other {
      background: rgba(40, 40, 40, 0.8);
      color: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .special-message {
      padding: 16px 20px;
      background: linear-gradient(135deg, rgba(255, 204, 0, 0.1), rgba(255, 204, 0, 0.05));
      border: 2px solid rgba(255, 204, 0, 0.3);
      border-radius: 15px;
      color: #ffcc00;
      font-weight: 600;
      text-align: center;
      box-shadow: 0 0 20px rgba(255, 204, 0, 0.2);
      animation: pulse-glow 2s ease-in-out infinite;
    }

    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(255, 204, 0, 0.2); }
      50% { box-shadow: 0 0 30px rgba(255, 204, 0, 0.4); }
    }

    .input-area {
      padding: 20px 30px;
      background: rgba(0, 0, 0, 0.4);
      border-top: 1px solid rgba(255, 0, 0, 0.2);
      position: relative;
    }

    .input-container {
      display: flex;
      gap: 12px;
      align-items: center;
      background: rgba(20, 0, 0, 0.6);
      border: 2px solid rgba(255, 0, 0, 0.3);
      border-radius: 15px;
      padding: 8px 12px;
      transition: all 0.3s ease;
    }

    .input-container:focus-within {
      border-color: #ff0000;
      box-shadow: 0 0 20px rgba(255, 0, 0, 0.3);
    }

    .emoji-btn {
      width: 40px;
      height: 40px;
      background: transparent;
      border: none;
      color: rgba(255, 255, 255, 0.5);
      font-size: 24px;
      cursor: pointer;
      transition: all 0.3s ease;
      border-radius: 10px;
    }

    .emoji-btn:hover {
      color: #ff0000;
      background: rgba(255, 0, 0, 0.1);
    }

    .message-input {
      flex: 1;
      background: transparent;
      border: none;
      outline: none;
      color: #fff;
      font-size: 15px;
      font-weight: 500;
      padding: 10px;
    }

    .message-input::placeholder {
      color: rgba(255, 255, 255, 0.3);
    }

    .send-btn {
      width: 45px;
      height: 45px;
      background: linear-gradient(135deg, #ff0000, #cc0000);
      border: none;
      border-radius: 12px;
      color: #fff;
      font-size: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(255, 0, 0, 0.4);
    }

    .send-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(255, 0, 0, 0.6);
    }

    .send-btn:active {
      transform: scale(0.95);
    }

    .emoji-picker {
      position: absolute;
      bottom: 90px;
      right: 30px;
      width: 320px;
      max-height: 300px;
      background: rgba(20, 0, 0, 0.95);
      border: 2px solid rgba(255, 0, 0, 0.4);
      border-radius: 20px;
      padding: 20px;
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 8px;
      overflow-y: auto;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(20px);
      z-index: 50;
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .emoji-picker::-webkit-scrollbar {
      width: 6px;
    }

    .emoji-picker::-webkit-scrollbar-thumb {
      background: rgba(255, 0, 0, 0.4);
      border-radius: 10px;
    }

    .emoji-item {
      font-size: 28px;
      cursor: pointer;
      transition: transform 0.2s ease;
      text-align: center;
      padding: 5px;
      border-radius: 8px;
    }

    .emoji-item:hover {
      transform: scale(1.3);
      background: rgba(255, 0, 0, 0.1);
    }

    @media (max-width: 768px) {
      .emoji-picker {
        right: 10px;
        left: 10px;
        width: auto;
        grid-template-columns: repeat(6, 1fr);
      }
    }

    /* MODAL */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 200;
      padding: 20px;
      animation: fadeIn 0.3s ease;
    }

    .modal-content {
      background: rgba(20, 0, 0, 0.95);
      border: 2px solid rgba(255, 0, 0, 0.5);
      border-radius: 20px;
      padding: 40px 30px;
      max-width: 500px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
      position: relative;
      animation: scaleIn 0.3s ease;
    }

    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }

    .modal-close {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      background: rgba(255, 0, 0, 0.2);
      border: 1px solid rgba(255, 0, 0, 0.4);
      border-radius: 10px;
      color: #ff0000;
      font-size: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .modal-close:hover {
      background: rgba(255, 0, 0, 0.3);
      transform: rotate(90deg);
    }

    .modal-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 24px;
      font-weight: 900;
      text-align: center;
      color: #ff0000;
      margin-bottom: 30px;
      letter-spacing: 3px;
      text-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
    }

    .modal-section {
      background: rgba(255, 0, 0, 0.05);
      border: 1px solid rgba(255, 0, 0, 0.2);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 15px;
    }

    .command-title {
      color: #ff0000;
      font-weight: 700;
      font-size: 16px;
      margin-bottom: 10px;
      font-family: 'Orbitron', sans-serif;
    }

    .command-desc {
      color: rgba(255, 255, 255, 0.7);
      font-size: 14px;
      line-height: 1.6;
    }

    /* LOGIN SCREEN */
    .login-screen {
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .login-box {
      background: rgba(20, 0, 0, 0.9);
      border: 2px solid rgba(255, 0, 0, 0.4);
      border-radius: 25px;
      padding: 50px 40px;
      max-width: 450px;
      width: 100%;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8), 0 0 100px rgba(255, 0, 0, 0.2);
      backdrop-filter: blur(20px);
      position: relative;
      overflow: hidden;
    }

    .login-box::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      height: 3px;
      background: linear-gradient(90deg, transparent, #ff0000, transparent);
      animation: scan-line 3s linear infinite;
    }

    @keyframes scan-line {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .login-logo {
      font-family: 'Orbitron', sans-serif;
      font-size: 48px;
      font-weight: 900;
      background: linear-gradient(135deg, #ff0000 0%, #cc0000 50%, #990000 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: 6px;
      margin-bottom: 50px;
      text-shadow: 0 0 40px rgba(255, 0, 0, 0.6);
    }

    .login-btn {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, rgba(255, 0, 0, 0.3), rgba(139, 0, 0, 0.3));
      border: 2px solid #ff0000;
      border-radius: 15px;
      color: #fff;
      font-size: 18px;
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: 3px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 0 30px rgba(255, 0, 0, 0.3);
    }

    .login-btn:hover {
      background: linear-gradient(135deg, rgba(255, 0, 0, 0.5), rgba(139, 0, 0, 0.5));
      box-shadow: 0 0 40px rgba(255, 0, 0, 0.6);
      transform: translateY(-2px);
    }

    .login-btn:active {
      transform: translateY(0);
    }

    .sidebar-overlay {
      display: none;
    }

    @media (max-width: 768px) {
      .sidebar-overlay {
        display: block;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(5px);
        z-index: 99;
      }
      .sidebar-overlay.hidden {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="cyber-bg"></div>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const firebaseConfig = {
      apiKey: "AIzaSyAe1-JfNde0NKIMdE7phfEXlm9JaqUH0jY",
      authDomain: "pulsari.firebaseapp.com",
      databaseURL: "https://pulsari-default-rtdb.firebaseio.com",
      projectId: "pulsari",
      storageBucket: "pulsari.firebasestorage.app",
      messagingSenderId: "824306321233",
      appId: "1:824306321233:web:2c9bfa02170a17d560b570"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    // HASHES DE WALLETS ADMINISTRATIVAS (SHA-256)
    const ADMIN_WALLETS = {
      "f501869e5d48a58ec2f92f988849b79410313f8d3885d51940bc27599c9339e0": "Ryachu",
      "819c961c022883f3e18a8008e43e26458519e48c1e4c70308009696987c8801d": "Itsuki"
    };

    const EMOJI_LIST = ["üòÄ","üòÉ","üòÑ","üòÅ","üòÜ","üòÖ","üòÇ","ü§£","üòä","üòá","üôÇ","üôÉ","üòâ","üòå","üòç","ü•∞","üòò","üòó","üòô","üòö","üòã","üòõ","üòù","üòú","ü§™","ü§®","üßê","ü§ì","üòé","ü§©","ü•≥","üòè","üòí","üòû","üòî","üòü","üòï","üôÅ","‚òπÔ∏è","üò£","üòñ","üò´","üò©","ü•∫","üò¢","üò≠","üò§","üò†","üò°","ü§¨","ü§Ø","üò≥","ü•µ","ü•∂","üò±","üò®","üò∞","üò•","üòì","ü§ó","ü§î","ü§≠","ü§´","ü§•","üò∂","üòê","üòë","üò¨","üôÑ","üòØ","üò¶","üòß","üòÆ","üò≤","ü•±","üò¥","ü§§","üò™","üòµ","ü§ê","ü•¥","ü§¢","ü§Æ","ü§ß","üò∑","ü§í","ü§ï","ü§ë","ü§†","üòà","üëø","üëπ","üë∫","ü§°","üëª","üíÄ","‚ò†Ô∏è","üëΩ","üëæ","ü§ñ","üéÉ","üò∫","üò∏","üòπ","üòª","üòº","üòΩ","üôÄ","üòø","üòæ","üëã","ü§ö","üñêÔ∏è","‚úã","üññ","üëå","ü§å","ü§è","‚úåÔ∏è","ü§û","ü§ü","ü§ò","ü§ô","üëà","üëâ","üëÜ","üñï","üëá","‚òùÔ∏è","üëç","üëé","‚úä","üëä","ü§õ","ü§ú","üëè","üôå","üëê","ü§≤","ü§ù","üôè","üí™","ü¶æ","ü¶ø","ü¶µ","ü¶∂","üëÇ","ü¶ª","üëÉ","üß†","ü´Ä","ü´Å","ü¶∑","ü¶¥","üëÄ","üëÅÔ∏è","üëÖ","üëÑ","üíã","ü©∏","‚ù§Ô∏è","üß°","üíõ","üíö","üíô","üíú","üñ§","ü§ç","ü§é","üíî","‚ù£Ô∏è","üíï","üíû","üíì","üíó","üíñ","üíò","üíù","üî•","‚ú®","üí´","‚≠ê","üåü","‚ú¥Ô∏è","‚ö°","üí•","üíØ","üöÄ","üéØ"];

    function App() {
      const [user, setUser] = useState(null);
      const [chan, setChan] = useState("general");
      const [messages, setMessages] = useState([]);
      const [users, setUsers] = useState([]);
      const [text, setText] = useState("");
      const [alertMsg, setAlertMsg] = useState(null);
      const [showAdminPanel, setShowAdminPanel] = useState(false);
      const [showEmoji, setShowEmoji] = useState(false);
      const [isMenuOpen, setIsMenuOpen] = useState(false);
      const [showHashDebug, setShowHashDebug] = useState(false);
      const [walletHash, setWalletHash] = useState("");
      const scrollRef = useRef();
      const inputRef = useRef();

      const hashWallet = async (address) => {
        const msgUint8 = new TextEncoder().encode(address.toLowerCase());
        const hashBuffer = await crypto.subtle.digest('SHA-256', msgUint8);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
      };

      const login = async () => {
        if (!window.ethereum) {
          alert("‚ö†Ô∏è MetaMask es requerido para acceder");
          return;
        }
        
        try {
          const accs = await window.ethereum.request({ method: 'eth_requestAccounts' });
          const wallet = accs[0].toLowerCase();
          const hashed = await hashWallet(wallet);

          setWalletHash(hashed);
          console.log("üîê WALLET HASH:", hashed);

          const snap = await db.ref('presence').orderByChild('wallet').equalTo(wallet).once('value');
          if (snap.exists()) {
            const promises = Object.keys(snap.val()).map(k => db.ref(`presence/${k}`).remove());
            await Promise.all(promises);
          }

          const cred = await auth.signInAnonymously();
          
          const isGod = ADMIN_WALLETS.hasOwnProperty(hashed);
          const adminName = ADMIN_WALLETS[hashed];
          const name = adminName || `Node_${wallet.slice(-4)}`;
          
          const userData = { 
            uid: cred.user.uid, 
            wallet, 
            name, 
            isGod, 
            color: isGod ? "#ffcc00" : "#ffffff",
            timestamp: Date.now()
          };
          
          await db.ref(`presence/${cred.user.uid}`).set(userData);
          db.ref(`presence/${cred.user.uid}`).onDisconnect().remove();
          setUser(userData);
        } catch (error) {
          console.error("‚ùå Error de autenticaci√≥n:", error);
          alert("Error al conectar con MetaMask");
        }
      };

      useEffect(() => {
        if (!user) return;
        
        const pRef = db.ref(`presence/${user.uid}`);
        pRef.on('value', snap => { 
          if (!snap.exists()) {
            console.log("Sesi√≥n eliminada, recargando...");
            window.location.reload(); 
          }
        });
        
        db.ref('system_alert').on('value', s => setAlertMsg(s.val()));
        
        const mRef = db.ref(`messages/${chan}`).limitToLast(50);
        mRef.on('value', s => {
          const val = s.val();
          setMessages(val ? Object.keys(val).map(k => ({id:k, ...val[k]})).sort((a,b) => a.time - b.time) : []);
        });
        
        db.ref('presence').on('value', s => {
          const data = s.val();
          setUsers(data ? Object.values(data).sort((a,b) => (b.isGod ? 1 : 0) - (a.isGod ? 1 : 0)) : []);
        });
        
        return () => { 
          mRef.off(); 
          db.ref('system_alert').off(); 
          pRef.off(); 
          db.ref('presence').off();
        };
      }, [user, chan]);

      useEffect(() => { 
        scrollRef.current?.scrollIntoView({ behavior: 'smooth' }); 
      }, [messages]);

      const handleSend = async () => {
        const trimmed = text.trim();
        if (!trimmed) return;
        
        if (user.isGod) {
          if (trimmed === '/clear') {
            try {
              await db.ref(`messages/${chan}`).remove();
              setText("");
              console.log(`‚úÖ [${user.name}] Chat limpiado en: ${chan}`);
              return;
            } catch (error) {
              console.error("‚ùå Error al limpiar:", error);
              return;
            }
          }
          
          if (trimmed.startsWith('/alert ')) {
            try {
              const msg = trimmed.substring(7).trim();
              if (msg) {
                await db.ref('system_alert').set(msg);
                setText("");
                console.log(`‚úÖ [${user.name}] Alerta creada: "${msg}"`);
                return;
              }
            } catch (error) {
              console.error("‚ùå Error al crear alerta:", error);
              return;
            }
          }
          
          if (trimmed === '/clearalert') {
            try {
              await db.ref('system_alert').remove();
              setText("");
              console.log(`‚úÖ [${user.name}] Alerta eliminada`);
              return;
            } catch (error) {
              console.error("‚ùå Error al eliminar alerta:", error);
              return;
            }
          }
        }
        
        try {
          const messageData = {
            content: trimmed, 
            name: user.name,
            uid: user.uid, 
            color: user.isGod ? "#ffcc00" : "#ffffff", 
            isGod: user.isGod || false, 
            time: Date.now()
          };
          
          await db.ref(`messages/${chan}`).push(messageData);
          setText("");
          setShowEmoji(false);
        } catch (error) {
          console.error("‚ùå Error al enviar mensaje:", error);
          alert("Error al enviar el mensaje");
        }
      };

      const handleEmojiSelect = (emoji) => {
        setText(text + emoji);
        inputRef.current?.focus();
      };

      if (!user) {
        return (
          <div className="login-screen">
            <div className="login-box">
              <div className="login-logo">MUZZSNAP</div>
              <button onClick={login} className="login-btn">
                INICIALIZAR
              </button>
            </div>
          </div>
        );
      }

      return (
        <>
          {isMenuOpen && <div className="sidebar-overlay" onClick={() => setIsMenuOpen(false)}></div>}
          
          <div className="container-main">
            <aside className={`sidebar ${isMenuOpen ? 'open' : ''}`}>
              <div className="logo">MUZZSNAP</div>
              
              <div className="section-title">Channels</div>
              {['general', 'espa√±ol'].map(c => (
                <button 
                  key={c} 
                  onClick={() => {
                    setChan(c); 
                    setIsMenuOpen(false);
                  }} 
                  className={`channel-btn ${chan === c ? 'active' : ''}`}
                >
                  # {c}
                </button>
              ))}
              
              <div className="section-title">Online ({users.length})</div>
              <div style={{flex: 1, overflowY: 'auto'}}>
                {users.map((u, i) => (
                  <div key={i} className="user-item">
                    <div className={`user-status ${u.isGod ? 'admin' : ''}`}></div>
                    <div className={`user-name ${u.isGod ? 'admin' : ''}`}>
                      {u.isGod && 'üëë '}{u.name}
                    </div>
                  </div>
                ))}
              </div>
              
              {user.isGod && (
                <button onClick={() => setShowAdminPanel(true)} className="admin-btn">
                  ADMIN_INDEX
                </button>
              )}
              
              <button onClick={() => setShowHashDebug(true)} className="disconnect-btn">
                Ver Info Wallet
              </button>
              
              <button onClick={() => window.location.reload()} className="disconnect-btn">
                Cerrar Sesi√≥n
              </button>
            </aside>

            <main className="chat-container">
              {alertMsg && (
                <div className="alert-banner">
                  !! ALERTA: {alertMsg} !!
                </div>
              )}
              
              <div className="chat-header">
                <button className="menu-btn" onClick={() => setIsMenuOpen(true)}>
                  <i className="fas fa-bars"></i>
                </button>
                <div className="sector-label">
                  Sector: <span className="sector-name">{chan}</span>
                </div>
                <div className="theme-toggle-container">
                  <div className="theme-toggle-circle"></div>
                </div>
              </div>

              <div className="messages-area" onClick={() => setShowEmoji(false)}>
                {messages.length === 0 ? (
                  <div className="special-message">
                    üëë Welcome to MuzzChat üëë
                  </div>
                ) : (
                  messages.map(m => (
                    <div key={m.id} className={`message-wrapper ${m.uid === user.uid ? 'me' : ''}`}>
                      <div className={`message-author ${m.isGod ? 'admin' : ''}`}>
                        {m.isGod && 'üëë '}{m.name || 'Unknown'}
                      </div>
                      <div className={`message-bubble ${m.uid === user.uid ? 'me' : 'other'}`}>
                        {m.content}
                      </div>
                    </div>
                  ))
                )}
                <div ref={scrollRef}></div>
              </div>

              <div className="input-area">
                {showEmoji && (
                  <div className="emoji-picker">
                    {EMOJI_LIST.map(e => (
                      <div key={e} onClick={() => handleEmojiSelect(e)} className="emoji-item">
                        {e}
                      </div>
                    ))}
                  </div>
                )}
                
                <div className="input-container">
                  <button 
                    onClick={(e) => {
                      e.stopPropagation();
                      setShowEmoji(!showEmoji);
                    }} 
                    className="emoji-btn"
                  >
                    üòä
                  </button>
                  <input 
                    ref={inputRef}
                    value={text} 
                    onChange={e => setText(e.target.value)} 
                    onKeyDown={e => e.key === 'Enter' && handleSend()} 
                    placeholder="Escribe un mensaje..." 
                    className="message-input" 
                    maxLength={500}
                  />
                  <button onClick={handleSend} className="send-btn">
                    <i className="fas fa-bolt"></i>
                  </button>
                </div>
              </div>
            </main>
          </div>

          {showAdminPanel && user.isGod && (
            <div className="modal-overlay" onClick={() => setShowAdminPanel(false)}>
              <div className="modal-content" onClick={e => e.stopPropagation()}>
                <button onClick={() => setShowAdminPanel(false)} className="modal-close">
                  <i className="fas fa-times"></i>
                </button>
                
                <div className="modal-title">SECURITY CONSOLE</div>
                
                <div className="modal-section">
                  <div className="command-title">/clear</div>
                  <div className="command-desc">
                    Elimina todo el historial de mensajes del sector actual.
                  </div>
                </div>
                
                <div className="modal-section">
                  <div className="command-title">/alert [mensaje]</div>
                  <div className="command-desc">
                    Crea una alerta de emergencia visible para todos los usuarios.<br/>
                    <span style={{fontSize: '12px', opacity: 0.7}}>Ejemplo: /alert Sistema en mantenimiento</span>
                  </div>
                </div>
                
                <div className="modal-section">
                  <div className="command-title">/clearalert</div>
                  <div className="command-desc">
                    Elimina la alerta de emergencia activa.
                  </div>
                </div>
              </div>
            </div>
          )}

          {showHashDebug && user && (
            <div className="modal-overlay" onClick={() => setShowHashDebug(false)}>
              <div className="modal-content" onClick={e => e.stopPropagation()}>
                <button onClick={() => setShowHashDebug(false)} className="modal-close">
                  <i className="fas fa-times"></i>
                </button>
                
                <div className="modal-title">WALLET INFO</div>
                
                <div className="modal-section">
                  <div className="command-title">Tu Wallet Hash</div>
                  <div 
                    style={{
                      fontSize: '11px',
                      wordBreak: 'break-all',
                      background: 'rgba(0,0,0,0.5)',
                      padding: '15px',
                      borderRadius: '10px',
                      marginTop: '10px',
                      cursor: 'pointer',
                      border: '1px solid rgba(255,0,0,0.2)'
                    }}
                    onClick={() => {
                      const el = document.createElement('textarea');
                      el.value = walletHash;
                      el.setAttribute('readonly', '');
                      el.style.position = 'absolute';
                      el.style.left = '-9999px';
                      document.body.appendChild(el);
                      el.select();
                      el.setSelectionRange(0, 99999);
                      document.execCommand('copy');
                      document.body.removeChild(el);
                      alert('‚úÖ Hash copiado!\n\nEnv√≠alo al desarrollador para ser admin');
                    }}
                  >
                    {walletHash}
                  </div>
                  <button 
                    onClick={() => {
                      const el = document.createElement('textarea');
                      el.value = walletHash;
                      el.setAttribute('readonly', '');
                      el.style.position = 'absolute';
                      el.style.left = '-9999px';
                      document.body.appendChild(el);
                      el.select();
                      el.setSelectionRange(0, 99999);
                      document.execCommand('copy');
                      document.body.removeChild(el);
                      alert('‚úÖ Hash copiado!');
                    }}
                    style={{
                      width: '100%',
                      marginTop: '15px',
                      padding: '12px',
                      background: 'linear-gradient(135deg, #ff0000, #cc0000)',
                      border: 'none',
                      borderRadius: '10px',
                      color: '#fff',
                      fontWeight: '900',
                      fontSize: '12px',
                      cursor: 'pointer',
                      letterSpacing: '1px'
                    }}
                  >
                    üìã COPIAR HASH
                  </button>
                </div>
                
                <div className="modal-section">
                  <div className="command-title">ESTADO ACTUAL</div>
                  <div className="command-desc">
                    Nombre: <strong style={{color: user.isGod ? '#ffcc00' : '#fff'}}>{user.name}</strong><br/>
                    Admin: <strong style={{color: user.isGod ? '#ffcc00' : '#ff0000'}}>
                      {user.isGod ? '‚úÖ S√ç' : '‚ùå NO'}
                    </strong>
                  </div>
                </div>

                {!user.isGod && (
                  <div className="modal-section" style={{borderColor: 'rgba(0,150,255,0.3)', background: 'rgba(0,150,255,0.05)'}}>
                    <div className="command-title" style={{color: '#0096ff'}}>C√ìMO SER ADMIN</div>
                    <div className="command-desc" style={{fontSize: '13px'}}>
                      1. Copia el hash de arriba<br/>
                      2. Env√≠alo al desarrollador<br/>
                      3. Espera confirmaci√≥n<br/>
                      4. Recarga la p√°gina
                    </div>
                  </div>
                )}
              </div>
            </div>
          )}
        </>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
